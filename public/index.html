<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Not in Philly</title>

	<!-- CSS -->
	<link rel="stylesheet" href="libs/bootstrap/dist/css/bootstrap.css">
	<link rel="stylesheet" href="libs/bootstrap/dist/css/bootstrap-theme.css">
	<link rel="stylesheet" href="libs/leaflet/dist/leaflet.css" />
	<link rel="stylesheet" href="css/styles.css" />

</head>
<body>
	 <nav class="navbar navbar-fixed-top navbar-default" role="navigation">
      <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <a class="navbar-brand" href="#">Let's make Philly awesome!</a>
          </div>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#">Link</a></li>
              <li><a href="#">Link</a></li>
            </ul>
          </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
	  </nav>
		<div id="map"></div>
		<div class="row">
			<div class="col-md-3">
				<div class="col-md-12 sidebar sidebar-left pull-left">
				<div class="panel-group sidebar-body" id="accordion-left">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<span class="pull-right slide-submenu">
									<i class="fa fa-chevron-left"></i>
								</span>
							</h4>
						</div>
						<div id="layers" class="panel-collapse collapse in">
							<div class="panel-body list-group">
								<a href="/" class="list-group-item">
									<img src="img/notinphilly_logo.png" />
								</a>
								<a href="#" class="list-group-item">
									<i class="fa fa-globe"></i> Open Street Map
								</a>
								<a href="#" class="list-group-item">
									<i class="fa fa-globe"></i> Bing
								</a>
								<a href="#" class="list-group-item">
									<i class="fa fa-globe"></i> WMS
								</a>
							</div>
						</div>
					</div>
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a data-toggle="collapse">
									<i class="fa fa-list-alt"></i>
									Properties
								</a>
							</h4>
						</div>
						<div id="properties" class="panel-collapse collapse in">
							<div class="panel-body">
								<p>
								Lorem ipsum dolor sit amet, vel an wisi propriae. Sea ut graece gloriatur. Per ei quando dicant vivendum. An insolens appellantur eos, doctus convenire vis et, at solet aeterno intellegebat qui.
								</p>
								<p>
								Elitr minimum inciderint qui no. Ne mea quaerendum scriptorem consequuntur. Mel ea nobis discere dignissim, aperiam patrioque ei ius. Stet laboramus eos te, his recteque mnesarchum an, quo id adipisci salutatus. Quas solet inimicus eu per. Sonet conclusionemque id vis.
								</p>
								<p>
								Eam vivendo repudiandae in, ei pri sint probatus. Pri et lorem praesent periculis, dicam singulis ut sed. Omnis patrioque sit ei, vis illud impetus molestiae id. Ex viderer assentior mel, inani liber officiis pro et. Qui ut perfecto repudiandae, per no hinc tation labores.
								</p>
								<p>
								Pro cu scaevola antiopam, cum id inermis salutatus. No duo liber gloriatur. Duo id vitae decore, justo consequat vix et. Sea id tale quot vitae.
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-8">

		</div>
		</div>

		<!-- JS -->
		<script src="libs/jquery/dist/jquery.js"></script>
		<script src="libs/angular/angular.js"></script>
		<script src="libs/angular-route/angular-route.js"></script>
		<script src="libs/bootstrap/dist/js/bootstrap.js"></script>

		<script src="libs/leaflet/dist/leaflet.js"></script>
		<script src="libs/leaflet-providers/leaflet-providers.js"></script>
		<script src="js/neighborhoods.js"></script>
		<script src="js/streets.js"></script>

		<!-- ANGULAR CUSTOM -->
		<script src="js/controllers/MainCtrl.js"></script>
		<script src="js/controllers/UserCtrl.js"></script>
		<script src="js/services/UserService.js"></script>
		<script src="js/appRoutes.js"></script>
		<script src="js/app.js"></script>

		<script type="text/javascript">
		 $(document).ready(function() {
			 var map = new L.Map("map", {
					 center: new L.LatLng(39.941300, -75.193566),
					 zoom: 13
			 });
			 L.tileLayer.provider("Stamen.Terrain").addTo(map);

			$("#map").data("map", map);

			var neighborhoodsData = getNeighborhoodsBoundries();

			var geoJsonLayer = L.geoJson(neighborhoodsData,
			{
				onEachFeature: attachEventsToLayers,
				style: {
					color: '#486CFA',
					weight: 2,
					fillOpacity: 0.4,
          fillColor: '#78D2FF'
				}
			});
			var features = neighborhoodsData.features;

			geoJsonLayer.addTo(map);

			$("#map").data("features", features);
			$("#map").data("geoJsonLayer", geoJsonLayer);
		 });

		function attachEventsToLayers(feature, layer){
				layer.setStyle(getRandomColor());
				layer.on({
				 mouseover: highlightNeighborhood,
				 mouseout: resetHighlightNeighborhood,
				 click: onLayerClick
		 		});
	 }

		function onLayerClick(e)
		{
			if(e.target.feature)
			{
				var geoJsonLayer = $("#map").data("geoJsonLayer");
				var map = $("#map").data("map");

				var triggeredFeature = e.target.feature;
				var layerBounds = e.layer.getBounds();

				$("#properties .panel-body").text("clicked -" + triggeredFeature.properties.name);

				map.removeLayer(geoJsonLayer);
				map.fitBounds(layerBounds);

				var streetsData = getStreets(triggeredFeature.properties.name);
				var streetsJson = { "type": "FeatureCollection",
														"features": streetsData
													};
				var geoJsonLayer = L.geoJson(streetsJson,
				{
					onEachFeature: attachEventsToStreets,
				});

				geoJsonLayer.addTo(map);
			}
		}

		function attachEventsToStreets(feature, layer){
				layer.setStyle(getRandomStreetColor());
				layer.on({
				 mouseover: highlightStreet,
 				 mouseout: resetHighlightStreet,
 				 click: onStreetClick
				});
	 	}

		function onStreetClick(e)
		{
			if(e.target.feature)
			{
				var map = $("#map").data("map");
				var properties = e.target.feature.properties;

				var imageSrc = "https://maps.googleapis.com/maps/api/streetview?size=190x190&location=" +  e.latlng.lat + "," + e.latlng.lng  + "&fov=90&heading=235&pitch=10"

				var popup = L.popup({
					keepInView: true
				})
		    .setLatLng(e.latlng)
		    .setContent("<p>Let's adopt a street!<br /> Street: " + properties.ST_NAME + " " + properties.L_HUNDRED + ", zipcode: " + properties.ZIP_LEFT + "</p><br/> <img src='" + imageSrc + "' />");

				popup.openOn(map);

				map.panTo(e.latlng);
			}
		}

		function getRandomColor()
		{
			var colorValue = Math.floor(Math.random() * 3) + 1;
			var style= {};

			switch (colorValue) {
				case 1:
					style = {
						color: 'Blue',
						weight: 2,
						fillColor: 'Red',
						fillOpacity: 0.2
					};
					break;
				case 2:
					style = {
						color: 'Blue',
						weight: 2,
						fillColor: 'Green',
						fillOpacity: 0.2
					};
					break;
				case 3:
					style = {
							color: 'Blue',
							weight: 2,
							fillColor: 'Yellow',
							fillOpacity: 0.2
						};
					break;
			}

			return style;
		}


		function getRandomStreetColor()
		{
			var colorValue = Math.floor(Math.random() * 3) + 1;
			var style= {};

			switch (colorValue) {
				case 1:
					style = {
						color: '#E897AA',
						opacity: 0.5,
						weight: 5
					};
					break;
				case 2:
					style = {
						color: '#98EBA2',
						opacity: 0.5,
						weight: 5
					};
					break;
				case 3:
					style = {
							color: '#E6EB98',
							opacity: 0.5,
							weight: 5
						};
					break;
			}

			return style;
		}

		function highlightNeighborhood(e) {
		    var layer = e.target;

		    layer.setStyle({
		        weight: 7,
						fillOpacity: 0.9,
		        color: '#666'
		    });

		    if (!L.Browser.ie && !L.Browser.opera) {
		        layer.bringToFront();
		    }
		}

		function resetHighlightNeighborhood(e) {
		    var layer = e.target;

				layer.setStyle({
					color: 'Blue',
					fillOpacity: 0.2,
					weight: 2
				});
		}

		function highlightStreet(e) {
				var layer = e.target;

				layer.setStyle({
						opacity: 0.8,
						weight: 15
				});

				if (!L.Browser.ie && !L.Browser.opera) {
						layer.bringToFront();
				}
		}

		function resetHighlightStreet(e) {
				var layer = e.target;

				layer.setStyle({
					opacity: 0.5,
					weight: 5
				});
		}

		</script>
</body>
</html>
